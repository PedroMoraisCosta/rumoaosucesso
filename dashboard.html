<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rumo ao Sucesso — Dashboard</title>

  <!-- Bootstrap 5 (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css" />
</head>

<body class="bg-body-tertiary">
  <div class="container-fluid py-3">
    <div class="row g-3">

      <!-- SIDEBAR -->
      <aside class="col-12 col-lg-3 col-xl-2">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <div class="fw-bold">Menu</div>
                <div class="text-secondary small">Rumo ao Sucesso</div>
              </div>
              <button id="btnToggleMenu" class="btn btn-outline-secondary btn-sm">☰</button>
            </div>

            <hr class="my-3"/>

            <nav id="menuList" class="list-group">
              <a class="list-group-item list-group-item-action" href="./dashboard.html#patrimonio" data-section="patrimonio">Património Líquido</a>
              <a class="list-group-item list-group-item-action" href="./dashboard.html#acoes" data-section="acoes">Ações + Dividendos</a>
              <a class="list-group-item list-group-item-action" href="./dashboard.html#cripto" data-section="cripto">Cripto</a>
              <a class="list-group-item list-group-item-action" href="./dashboard.html#p2p" data-section="p2p">P2P</a>
              <a class="list-group-item list-group-item-action" href="./dashboard.html#fundos" data-section="fundos">Fundos Parados</a>
              <a class="list-group-item list-group-item-action" href="./dashboard.html#vendas" data-section="vendas">Vendas / Realizações</a>
              <a class="list-group-item list-group-item-action" href="./dashboard.html#graficos" data-section="graficos">Gráficos</a>
              <a class="list-group-item list-group-item-action" href="./dashboard.html#ia" data-section="ia">Resumo por IA</a>
              <a href="#historico" data-section="historico" class="list-group-item list-group-item-action">Histórico</a>

            </nav>

            <hr class="my-3"/>

            <div class="small text-secondary">Sessão</div>
            <div id="sessionBox" class="border rounded p-2 small bg-white">
              <div><span class="badge text-bg-secondary" id="badgeMode">—</span></div>
              <div class="text-truncate" id="sessionEmail">—</div>
              <div class="text-secondary" id="sessionWhen">—</div>
              <div class="mt-2 d-grid">
                <button id="btnLogout" class="btn btn-outline-danger btn-sm">Sair</button>
              </div>
            </div>

            <div class="mt-3 small text-secondary">
              Exportar JSON = backup. Importar JSON = recuperar/migrar.
              <span class="text-primary">Dados reais ficam no teu dispositivo.</span>
            </div>
          </div>
        </div>
      </aside>

      <!-- MAIN -->
      <main class="col-12 col-lg-9 col-xl-10">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div>
            <h4 class="mb-0" id="pageTitle">Dashboard (V1)</h4>
            <div class="text-secondary">Rumo ao Sucesso — Portefólio</div>
          </div>
          <div class="d-flex gap-2 align-items-center">
            <span class="badge text-bg-success" id="badgeStatus">App a correr ✅</span>
          </div>
        </div>

        <!-- TOP ACTIONS -->
        <div class="card shadow-sm mb-3">
          <div class="card-body d-flex flex-wrap gap-2 align-items-center justify-content-between">
            <div class="fw-semibold">Atalhos rápidos</div>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-primary btn-sm" id="btnAddMovement">Adicionar movimento (em breve)</button>
              <button class="btn btn-outline-secondary btn-sm" id="btnExportJson">Exportar JSON</button>
              <button class="btn btn-outline-secondary btn-sm" id="btnImportJson">Importar JSON</button>
              <button class="btn btn-outline-secondary btn-sm" id="btnLoadDemo">Carregar Demo</button>
              <button class="btn btn-outline-danger btn-sm" id="btnWipeAll">Limpar dados</button>
            </div>
          </div>
        </div>

        
        <!-- SECTION: PATRIMONIO -->
<section id="sec-patrimonio" class="dash-section">
  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <h5 class="mb-1">Património (V1)</h5>
      <div class="text-secondary small mb-3">
        Total investido = (Ações + Cripto + P2P).<br>
        Ativos atuais = (Ações + Cripto + P2P final).<br>
        Património total = Ativos atuais + Fundos Parados + Banco Pessoal.
      </div>

      <!-- KPIs topo -->
      <div class="row g-3">
        <div class="col-12 col-md-3">
          <div class="border rounded p-3 bg-white h-100">
            <div class="text-secondary small">Total investido (ativos)</div>
            <div class="fs-3 fw-bold" id="plTotalInvestido">0,00 €</div>
            <div class="small text-secondary">Ações + Cripto + P2P</div>
          </div>
        </div>

        <div class="col-12 col-md-3">
          <div class="border rounded p-3 bg-white h-100">
            <div class="text-secondary small">Ativos atuais</div>
            <div class="fs-3 fw-bold" id="plAtivosAtuais">0,00 €</div>
            <div class="small text-secondary">Ações + Cripto + P2P (final)</div>
          </div>
        </div>

        <div class="col-12 col-md-3">
          <div class="border rounded p-3 bg-white h-100">
            <div class="text-secondary small">Lucro (valorização)</div>
            <div class="fs-3 fw-bold" id="plLucroTotal">0,00 €</div>
            <div class="small text-secondary">% lucro geral: <span id="plPctLucro">0,00%</span></div>
          </div>
        </div>

        <div class="col-12 col-md-3">
          <div class="border rounded p-3 bg-white h-100">
            <div class="text-secondary small">Património total</div>
            <div class="fs-3 fw-bold" id="plPatrimonioTotal">0,00 €</div>
            <div class="small text-secondary">+ Fundos Parados + Banco Pessoal</div>
          </div>
        </div>
      </div>

      <hr class="my-3"/>

      <!-- Banco pessoal -->
      <div class="row g-3 align-items-end">
        <div class="col-12 col-md-4">
          <label class="form-label">Banco pessoal (€)</label>
          <input id="inpBancoPessoal" type="number" step="0.01" class="form-control" placeholder="ex: 1500">
        </div>
        <div class="col-12 col-md-4">
          <button id="btnSaveBancoPessoal" class="btn btn-primary w-100" type="button">Guardar</button>
        </div>
        <div class="col-12 col-md-4 text-secondary small">
          Valor manual. Entra no “Património total”.
        </div>
      </div>

      <hr class="my-3"/>

      <!-- Ganhos recorrentes (estimativa) -->
      <div class="border rounded p-3 bg-white">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
          <div class="fw-semibold">Total de juros + dividendos (estimativa)</div>
          <div class="small text-secondary">Dividendos + P2P + Fundos Parados</div>
        </div>

        <div class="row g-3 mt-1">
          <div class="col-12 col-md-4">
            <div class="text-secondary small">Ano</div>
            <div class="fs-4 fw-bold" id="plRecAno">0,00 €</div>
          </div>
          <div class="col-12 col-md-4">
            <div class="text-secondary small">Mês</div>
            <div class="fs-4 fw-bold" id="plRecMes">0,00 €</div>
          </div>
          <div class="col-12 col-md-4">
            <div class="text-secondary small">Dia</div>
            <div class="fs-4 fw-bold" id="plRecDia">0,00 €</div>
          </div>
        </div>

        <hr class="my-3"/>

        <div class="row g-3">
          <div class="col-12 col-md-4">
            <div class="text-secondary small">Dividendos (ano)</div>
            <div class="fw-bold" id="plDvAno">0,00 €</div>
            <div class="small text-secondary">mês: <span id="plDvMes">0,00 €</span> | dia: <span id="plDvDia">0,00 €</span></div>
          </div>

          <div class="col-12 col-md-4">
            <div class="text-secondary small">P2P (juros/ano)</div>
            <div class="fw-bold" id="plP2Ano">0,00 €</div>
            <div class="small text-secondary">mês: <span id="plP2Mes">0,00 €</span> | dia: <span id="plP2Dia">0,00 €</span></div>
          </div>

          <div class="col-12 col-md-4">
            <div class="text-secondary small">Fundos (juros/ano)</div>
            <div class="fw-bold" id="plFdAno">0,00 €</div>
            <div class="small text-secondary">mês: <span id="plFdMes">0,00 €</span> | dia: <span id="plFdDia">0,00 €</span></div>
          </div>
        </div>

        <div class="small text-secondary mt-2">
          Nota: isto é uma estimativa anual (run-rate). Não é “realizado” automaticamente.
        </div>
      </div>

    </div>
  </div>
</section>


        <!-- SECTION: ACOES + DIVIDENDOS -->
        <section id="sec-acoes" class="dash-section">
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between">
                <h5 class="mb-0">Ações + Dividendos</h5>
                <button class="btn btn-outline-danger btn-sm" id="btnStocksWipe">Limpar tudo</button>
              </div>
              <div class="text-secondary small mb-3">Ações (em cima) + Dividendos (em baixo). Dividendos usam automaticamente o nº ações por ticker.</div>

              <div class="row g-3 mb-3">
                <div class="col-12 col-md-3">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Total Investido em Ações</div>
                    <div class="fs-4 fw-bold" id="stTotalInvest">0,00 €</div>
                  </div>
                </div>
                <div class="col-12 col-md-3">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Valor Atual</div>
                    <div class="fs-4 fw-bold" id="stTotalCurrent">0,00 €</div>
                  </div>
                </div>
                <div class="col-12 col-md-3">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Lucro</div>
                    <div class="fs-4 fw-bold" id="stTotalProfit">0,00 €</div>
                  </div>
                </div>
                <div class="col-12 col-md-3">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">%</div>
                    <div class="fs-4 fw-bold" id="stTotalPct">0,00%</div>
                  </div>
                </div>
              </div>

              <!-- ACOES FORM -->
              <div class="border rounded p-3 bg-white mb-3">
                <div class="fw-semibold mb-2">Ações</div>
                <div class="row g-2 align-items-end">
                  <div class="col-12 col-md-3">
                    <label class="form-label">Ticker</label>
                    <input id="stTicker" class="form-control" placeholder="ex: META">
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">Nº ações</label>
                    <input id="stQty" type="number" step="1" class="form-control" placeholder="ex: 3">
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">Preço médio</label>
                    <input id="stAvg" type="number" step="0.0001" class="form-control" placeholder="ex: 200">
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">Preço atual</label>
                    <input id="stCur" type="number" step="0.0001" class="form-control" placeholder="ex: 230">
                  </div>
                </div>
                <div class="mt-2 d-flex gap-2">
                  <button class="btn btn-primary" id="stAdd">Adicionar</button>
                  <button class="btn btn-outline-secondary" id="stCancelEdit">Cancelar edição</button>
                </div>
              </div>

              <div class="table-responsive bg-white border rounded">
                <table class="table table-sm align-middle mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Ticker</th>
                      <th class="text-end">Nº ações</th>
                      <th class="text-end">Preço médio</th>
                      <th class="text-end">Preço atual</th>
                      <th class="text-end">Investido</th>
                      <th class="text-end">Lucro</th>
                      <th class="text-end">%</th>
                      <th class="text-end">Ações</th>
                    </tr>
                  </thead>
                  <tbody id="stTable"></tbody>
                </table>
              </div>

              <div class="text-secondary small mt-2">
                Nota: ao alterar o nº de ações aqui, o bloco de dividendos usa automaticamente esse nº por ticker.
              </div>

              <hr class="my-4"/>

              <!-- DIVIDENDOS -->
              <div class="d-flex align-items-center justify-content-between">
                <div class="fw-semibold">Dividendos</div>
                <button class="btn btn-outline-danger btn-sm" id="btnDivWipe">Limpar tudo</button>
              </div>

              <div class="border rounded p-3 bg-white mt-2 mb-3">
                <div class="row g-2 align-items-end">
                  <div class="col-12 col-md-3">
                    <label class="form-label">Ticker</label>
                    <select id="dvTicker" class="form-select"></select>
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">Nº ações (auto)</label>
                    <input id="dvQtyAuto" class="form-control" disabled>
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">Dividendo/ano por ação (€)</label>
                    <input id="dvYearPerShare" type="number" step="0.0001" class="form-control" placeholder="ex: 0.50">
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">Pagamentos</label>
                    <select id="dvPay" class="form-select">
                      <option value="12">Mensal</option>
                      <option value="4">Trimestral</option>
                      <option value="2">Semestral</option>
                      <option value="1">Anual</option>
                    </select>
                  </div>
                </div>
                <div class="mt-2 d-flex gap-2">
                  <button class="btn btn-primary" id="dvAdd">Adicionar</button>
                  <button class="btn btn-outline-secondary" id="dvCancelEdit">Cancelar edição</button>
                </div>
              </div>

              <div class="table-responsive bg-white border rounded">
                <table class="table table-sm align-middle mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Ticker</th>
                      <th class="text-end">Nº ações</th>
                      <th class="text-end">€/ano por ação</th>
                      <th class="text-end">Recebido/ano</th>
                      <th class="text-end">/mês</th>
                      <th class="text-end">/dia</th>
                      <th class="text-end">Por pagamento</th>
                      <th class="text-end">Ações</th>
                    </tr>
                  </thead>
                  <tbody id="dvTable"></tbody>
                </table>
              </div>

              <div class="text-secondary small mt-2">
                Dica: se um ticker não aparece aqui, primeiro adiciona-o no bloco de ações.
              </div>

            </div>
          </div>
        </section>

        <!-- SECTION: CRIPTO -->
        <section id="sec-cripto" class="dash-section">
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between">
                <h5 class="mb-0">Cripto</h5>
                <button class="btn btn-outline-danger btn-sm" id="btnCryptoWipe">Limpar tudo</button>
              </div>
              <div class="text-secondary small mb-3">Quase igual às ações: moeda, investido, quantidade, preço atual, valor atual, lucro e %.</div>

              <div class="row g-3 mb-3">
                <div class="col-12 col-md-3">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Total investido</div>
                    <div class="fs-4 fw-bold" id="crTotalInvest">0,00 €</div>
                  </div>
                </div>
                <div class="col-12 col-md-3">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Valor atual</div>
                    <div class="fs-4 fw-bold" id="crTotalCurrent">0,00 €</div>
                  </div>
                </div>
                <div class="col-12 col-md-3">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Lucro</div>
                    <div class="fs-4 fw-bold" id="crTotalProfit">0,00 €</div>
                  </div>
                </div>
                <div class="col-12 col-md-3">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">%</div>
                    <div class="fs-4 fw-bold" id="crTotalPct">0,00%</div>
                  </div>
                </div>
              </div>

              <div class="border rounded p-3 bg-white mb-3">
                <div class="row g-2 align-items-end">
                  <div class="col-12 col-md-3">
                    <label class="form-label">Moeda</label>
                    <input id="crCoin" class="form-control" placeholder="ex: BTC / ETH / SOL">
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">€ Investido</label>
                    <input id="crInvest" type="number" step="0.01" class="form-control" placeholder="ex: 500">
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">Quantidade</label>
                    <input id="crQty" type="number" step="0.00000001" class="form-control" placeholder="ex: 0.01">
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">Preço atual (€/moeda)</label>
                    <input id="crPrice" type="number" step="0.0001" class="form-control" placeholder="ex: 60000">
                  </div>
                </div>
                <div class="mt-2 d-flex gap-2">
                  <button class="btn btn-primary" id="crAdd">Adicionar</button>
                  <button class="btn btn-outline-secondary" id="crCancelEdit">Cancelar edição</button>
                </div>
              </div>

              <div class="table-responsive bg-white border rounded">
                <table class="table table-sm align-middle mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Moeda</th>
                      <th class="text-end">€ Investido</th>
                      <th class="text-end">Quantidade</th>
                      <th class="text-end">Preço atual</th>
                      <th class="text-end">Valor atual</th>
                      <th class="text-end">Lucro</th>
                      <th class="text-end">%</th>
                      <th class="text-end">Ações</th>
                    </tr>
                  </thead>
                  <tbody id="crTable"></tbody>
                </table>
              </div>

            </div>
          </div>
        </section>
        <!-- SECTION: HISTORICO -->
<section id="sec-historico" class="dash-section" style="display:none;">
  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
        <div>
          <h5 class="mb-0">Histórico (mensal)</h5>
          <div class="text-secondary small">
            Guarda um “snapshot” por mês do património e dos blocos principais (Ações, Cripto, P2P, Fundos, Banco).
          </div>
        </div>
        <div class="d-flex gap-2">
          <button id="btnHistSnapshotNow" class="btn btn-primary btn-sm" type="button">Guardar mês atual</button>
          <button id="btnHistExport" class="btn btn-outline-secondary btn-sm" type="button">Exportar histórico</button>
          <button id="btnHistWipe" class="btn btn-outline-danger btn-sm" type="button">Limpar histórico</button>
        </div>
      </div>

      <hr class="my-3"/>

      <div class="row g-3">
        <div class="col-12 col-lg-4">
          <div class="border rounded p-3 bg-white">
            <div class="fw-semibold mb-2">Criar snapshot manual</div>

            <label class="form-label">Mês (AAAA-MM)</label>
            <input id="histMonth" type="month" class="form-control" />

            <div class="text-secondary small mt-2">
              Dica: normalmente não precisas disto. O botão “Guardar mês atual” chega.
            </div>

            <button id="btnHistSnapshotMonth" class="btn btn-outline-primary w-100 mt-3" type="button">
              Guardar este mês
            </button>
          </div>
        </div>

        <div class="col-12 col-lg-8">
          <div class="table-responsive bg-white border rounded">
            <table class="table table-sm align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Mês</th>
                  <th class="text-end">Banco</th>
                  <th class="text-end">Ações (atual)</th>
                  <th class="text-end">Cripto (atual)</th>
                  <th class="text-end">P2P (final)</th>
                  <th class="text-end">Fundos</th>
                  <th class="text-end">Património total</th>
                  <th class="text-end">Ações</th>
                </tr>
              </thead>
              <tbody id="histTable"></tbody>
            </table>
          </div>

          <div class="text-secondary small mt-2">
            Nota: isto é histórico mensal. Não é “lucro realizado”, é fotografia do estado do teu portefólio naquele mês.
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


        <!-- SECTION: P2P -->
        <section id="sec-p2p" class="dash-section">
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between">
                <h5 class="mb-0">P2P</h5>
                <button class="btn btn-outline-danger btn-sm" id="btnP2PWipe">Limpar tudo</button>
              </div>
              <div class="text-secondary small mb-3">
                Plataforma + projeto + valor + % anual + anos (ou datas). Calcula valor final (juros compostos anuais), lucro e %.
                Faz também média de lucro (%).
              </div>

              <div class="row g-3 mb-3">
                <div class="col-12 col-md-3">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Total investido</div>
                    <div class="fs-4 fw-bold" id="p2Invest">0,00 €</div>
                  </div>
                </div>
                <div class="col-12 col-md-3">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Valor final (estimado)</div>
                    <div class="fs-4 fw-bold" id="p2Final">0,00 €</div>
                  </div>
                </div>
                <div class="col-12 col-md-3">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Lucro</div>
                    <div class="fs-4 fw-bold" id="p2Profit">0,00 €</div>
                  </div>
                </div>
                <div class="col-12 col-md-3">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Média lucro (%)</div>
                    <div class="fs-4 fw-bold" id="p2AvgPct">0,00%</div>
                  </div>
                </div>
              </div>

              <div class="border rounded p-3 bg-white mb-3">
                <div class="row g-2 align-items-end">
                  <div class="col-12 col-md-3">
                    <label class="form-label">Plataforma</label>
                    <input id="p2Platform" class="form-control" placeholder="ex: Mintos">
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">Projeto</label>
                    <input id="p2Project" class="form-control" placeholder="ex: Projeto X">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">€ Investido</label>
                    <input id="p2Amount" type="number" step="0.01" class="form-control" placeholder="ex: 1000">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">% anual</label>
                    <input id="p2Rate" type="number" step="0.01" class="form-control" placeholder="ex: 9.5">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Anos (opcional)</label>
                    <input id="p2Years" type="number" step="0.01" class="form-control" placeholder="ex: 2">
                  </div>

                  <div class="col-12 col-md-3">
                    <label class="form-label">Início (opcional)</label>
                    <input id="p2Start" type="date" class="form-control">
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">Fim (opcional)</label>
                    <input id="p2End" type="date" class="form-control">
                  </div>

                </div>
                <div class="mt-2 d-flex gap-2">
                  <button class="btn btn-primary" id="p2Add">Adicionar</button>
                  <button class="btn btn-outline-secondary" id="p2CancelEdit">Cancelar edição</button>
                </div>
                <div class="text-secondary small mt-2">
                  Se preencheres datas, o programa calcula os anos automaticamente (e ignora o campo “anos”).
                </div>
              </div>

              <div class="table-responsive bg-white border rounded">
                <table class="table table-sm align-middle mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Plataforma</th>
                      <th>Projeto</th>
                      <th class="text-end">€ Investido</th>
                      <th class="text-end">% anual</th>
                      <th class="text-end">Anos</th>
                      <th class="text-end">Valor final</th>
                      <th class="text-end">Lucro</th>
                      <th class="text-end">%</th>
                      <th class="text-end">Ações</th>
                    </tr>
                  </thead>
                  <tbody id="p2Table"></tbody>
                </table>
              </div>

            </div>
          </div>
        </section>

        <!-- SECTION: FUNDOS PARADOS -->
        <section id="sec-fundos" class="dash-section">
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between">
                <h5 class="mb-0">Fundos Parados</h5>
                <button class="btn btn-outline-danger btn-sm" id="btnFundsWipe">Limpar tudo</button>
              </div>
              <div class="text-secondary small mb-3">
                Plataforma + valor + juro (mensal ou anual). Mostra % e juro anual estimado. Estes valores entram no Património Líquido como “cash”.
              </div>

              <div class="row g-3 mb-3">
                <div class="col-12 col-md-4">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Total fundos parados (€)</div>
                    <div class="fs-4 fw-bold" id="fdTotal">0,00 €</div>
                  </div>
                </div>
                <div class="col-12 col-md-4">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Juro anual estimado (€)</div>
                    <div class="fs-4 fw-bold" id="fdYearProfit">0,00 €</div>
                  </div>
                </div>
                <div class="col-12 col-md-4">
                  <div class="border rounded p-3 bg-white h-100">
                    <div class="text-secondary small">Taxa anual média</div>
                    <div class="fs-4 fw-bold" id="fdAvgRate">0,00%</div>
                  </div>
                </div>
              </div>

              <div class="border rounded p-3 bg-white mb-3">
                <div class="row g-2 align-items-end">
                  <div class="col-12 col-md-4">
                    <label class="form-label">Plataforma</label>
                    <input id="fdPlatform" class="form-control" placeholder="ex: Trade Republic">
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">€ Valor</label>
                    <input id="fdAmount" type="number" step="0.01" class="form-control" placeholder="ex: 2000">
                  </div>
                  <div class="col-12 col-md-3">
                    <label class="form-label">Juro (%)</label>
                    <input id="fdRate" type="number" step="0.01" class="form-control" placeholder="ex: 3.5">
                  </div>
                  <div class="col-12 col-md-2">
                    <label class="form-label">Periodicidade</label>
                    <select id="fdFreq" class="form-select">
                      <option value="annual">Anual</option>
                      <option value="monthly">Mensal</option>
                    </select>
                  </div>
                </div>
                <div class="mt-2 d-flex gap-2">
                  <button class="btn btn-primary" id="fdAdd">Adicionar</button>
                  <button class="btn btn-outline-secondary" id="fdCancelEdit">Cancelar edição</button>
                </div>
              </div>

              <div class="table-responsive bg-white border rounded">
                <table class="table table-sm align-middle mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Plataforma</th>
                      <th class="text-end">€ Valor</th>
                      <th class="text-end">Taxa anual (%)</th>
                      <th class="text-end">Juro/ano (€)</th>
                      <th class="text-end">Ações</th>
                    </tr>
                  </thead>
                  <tbody id="fdTable"></tbody>
                </table>
              </div>

            </div>
          </div>
        </section>

        <!-- SECTION: VENDAS -->
        <section id="sec-vendas" class="dash-section">
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <section id="vendasSection" class="app-section">
                <div class="d-flex align-items-center justify-content-between mb-2 flex-wrap gap-2">
                  <div>
                    <h3 class="mb-0">Vendas / Realizações</h3>
                    <div class="text-secondary small">Regista vendas totais/parciais e acompanha lucro realizado (com imposto estimado opcional).</div>
                  </div>

                  <div class="d-flex gap-2">
                    <select id="filterYear" class="form-select form-select-sm" style="max-width:140px">
                      <option value="all">Todos</option>
                    </select>

                    <select id="filterClasse" class="form-select form-select-sm" style="max-width:160px">
                      <option value="all">Todas</option>
                      <option value="acoes">Ações/ETF</option>
                      <option value="cripto">Cripto</option>
                      <option value="outros">Outros</option>
                    </select>
                  </div>
                </div>

                <!-- Cards topo -->
                <div class="row g-2 mb-3">
                  <div class="col-md-2">
                    <div class="card p-2">
                      <div class="small text-secondary">Total Investido</div>
                      <div class="fs-4 fw-bold" id="t_invested">0,00 €</div>
                    </div>
                  </div>

                  <div class="col-md-2">
                    <div class="card p-2">
                      <div class="small text-secondary">Total Recebido</div>
                      <div class="fs-4 fw-bold" id="t_received">0,00 €</div>
                    </div>
                  </div>

                  <div class="col-md-2">
                    <div class="card p-2">
                      <div class="small text-secondary">Lucro/Prejuízo</div>
                      <div class="fs-4 fw-bold" id="t_profit">0,00 €</div>
                    </div>
                  </div>

                  <div class="col-md-2">
                    <div class="card p-2">
                      <div class="small text-secondary">% Realizado</div>
                      <div class="fs-4 fw-bold" id="t_profit_pct">0,00%</div>
                    </div>
                  </div>

                  <div class="col-md-2 tax-ui">
                    <div class="card p-2">
                      <div class="small text-secondary">Imposto estimado</div>
                      <div class="fs-4 fw-bold" id="t_tax">0,00 €</div>
                    </div>
                  </div>

                  <div class="col-md-2 tax-ui">
                    <div class="card p-2">
                      <div class="small text-secondary">Líquido (após imposto)</div>
                      <div class="fs-4 fw-bold" id="t_net">0,00 €</div>
                    </div>
                  </div>
                </div>

                <!-- Imposto -->
                <div class="card p-2 mb-3">
                  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                    <div class="d-flex align-items-center gap-2">
                      <input id="toggleTax" type="checkbox" class="form-check-input" checked />
                      <label for="toggleTax" class="form-check-label">Mostrar imposto estimado</label>
                    </div>

                    <div class="d-flex align-items-center gap-2 tax-ui">
                      <span class="text-secondary small">Taxa (%)</span>
                      <input id="taxRate" type="number" class="form-control form-control-sm" style="width:90px" value="28" min="0" max="100" step="0.1" />
                    </div>

                    <div class="ms-auto text-secondary small">
                      Regra: imposto só aplica em lucro positivo.
                    </div>
                  </div>
                </div>

                <!-- Resumo anual -->
                <div class="card p-2 mb-3">
                  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                    <div class="fw-semibold">Resumo anual (com filtros)</div>
                    <div class="text-secondary small">Usa os filtros “Ano” e “Classe” para ver o resumo do período.</div>
                  </div>

                  <div class="row g-2 mt-1">
                    <div class="col-md-3">
                      <div class="border rounded p-2 bg-white">
                        <div class="small text-secondary">Lucro do período</div>
                        <div class="fw-bold" id="y_profit">0,00 €</div>
                      </div>
                    </div>
                    <div class="col-md-3 tax-ui">
                      <div class="border rounded p-2 bg-white">
                        <div class="small text-secondary">Imposto do período</div>
                        <div class="fw-bold" id="y_tax">0,00 €</div>
                      </div>
                    </div>
                    <div class="col-md-3 tax-ui">
                      <div class="border rounded p-2 bg-white">
                        <div class="small text-secondary">Líquido do período</div>
                        <div class="fw-bold" id="y_net">0,00 €</div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="border rounded p-2 bg-white">
                        <div class="small text-secondary">Nº operações</div>
                        <div class="fw-bold" id="y_count">0</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Form -->
                <div class="card p-3 mb-3">
                  <div class="d-flex align-items-center justify-content-between mb-2">
                    <strong>Nova realização</strong>
                    <button id="btnVendasClearAll" class="btn btn-sm btn-outline-danger">Limpar tudo</button>
                  </div>

                  <form id="tradeForm" class="row g-2">
                    <div class="col-md-2">
                      <label class="form-label small text-secondary">Data</label>
                      <input id="tradeDate" type="date" class="form-control" required />
                    </div>

                    <div class="col-md-2">
                      <label class="form-label small text-secondary">Classe</label>
                      <select id="tradeClasse" class="form-select" required>
                        <option value="acoes">Ações/ETF</option>
                        <option value="cripto">Cripto</option>
                        <option value="outros">Outros</option>
                      </select>
                    </div>

                    <div class="col-md-2">
                      <label class="form-label small text-secondary">Ticker/Moeda</label>
                      <input id="tradeTicker" type="text" class="form-control" placeholder="ex: META / BTC" required />
                    </div>

                    <div class="col-md-2">
                      <label class="form-label small text-secondary">Quantidade vendida</label>
                      <input id="tradeQty" type="number" class="form-control" step="0.00000001" min="0" required />
                    </div>

                    <div class="col-md-2">
                      <label class="form-label small text-secondary">Preço médio (compra)</label>
                      <input id="tradeAvgBuy" type="number" class="form-control" step="0.00000001" min="0" required />
                    </div>

                    <div class="col-md-2">
                      <label class="form-label small text-secondary">Preço de venda</label>
                      <input id="tradeSellPrice" type="number" class="form-control" step="0.00000001" min="0" required />
                    </div>

                    <div class="col-md-2">
                      <label class="form-label small text-secondary">Comissões/Taxas</label>
                      <input id="tradeFees" type="number" class="form-control" step="0.01" min="0" value="0" />
                    </div>

                    <div class="col-md-10">
                      <label class="form-label small text-secondary">Notas (opcional)</label>
                      <input id="tradeNotes" type="text" class="form-control" placeholder="ex: venda parcial para tirar 100€ de lucro" />
                    </div>

                    <div class="col-12 d-flex gap-2 mt-2">
                      <button id="btnTradeAdd" class="btn btn-primary">Adicionar</button>
                      <button id="btnTradeCancel" class="btn btn-outline-secondary d-none" type="button">Cancelar edição</button>
                    </div>
                  </form>
                </div>

                <!-- Tabela -->
                <div class="card p-3">
                  <div class="table-responsive">
                    <table class="table table-sm align-middle">
                      <thead>
                        <tr class="text-secondary">
                          <th>Data</th>
                          <th>Classe</th>
                          <th>Ticker</th>
                          <th class="text-end">Qty</th>
                          <th class="text-end">Médio</th>
                          <th class="text-end">Venda</th>
                          <th class="text-end">Investido</th>
                          <th class="text-end">Recebido</th>
                          <th class="text-end">Lucro</th>
                          <th class="text-end">%</th>
                          <th class="text-end">Comissões</th>
                          <th class="text-end tax-ui">Imposto</th>
                          <th class="text-end tax-ui">Líquido</th>
                          <th class="text-end">Ações</th>
                        </tr>
                      </thead>
                      <tbody id="tradesTbody"></tbody>
                    </table>
                  </div>
                </div>
              </section>
            </div>
          </div>
        </section>

        <section id="sec-graficos" class="dash-section">
          <div class="card shadow-sm mb-3">
            <div class="card-body">
              <h5>Gráficos</h5>
              <div class="text-secondary">Em breve.</div>
            </div>
          </div>
        </section>

      </main>
    </div>
  </div>

  <script src="./app.js"></script>
  <script src="./vendas.js"></script>

</body>
</html>
